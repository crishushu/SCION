/*! scion 2014-06-23 */

(function(){if(!this.require){var a={},b={},c=function(f,g){var h,i=d(g,f),j=b[i];if(j)return j.exports;if(!(h=a[i]||a[i=d(i,"./index")]))throw"module '"+f+"' not found";j={id:i,exports:{}};try{return b[i]=j,h(j.exports,function(a){return c(a,e(i))},j),j.exports}catch(k){throw delete b[i],k}},d=function(a,b){var c,d,e=[];c=/^\.\.?(\/|$)/.test(b)?[a,b].join("/").split("/"):b.split("/");for(var f=0,g=c.length;g>f;f++)d=c[f],".."==d?e.pop():"."!=d&&""!=d&&e.push(d);return e.join("/")},e=function(a){return a.split("/").slice(0,-1).join("/")};this.require=function(a){return c(a,"")},this.require.define=function(b){for(var c in b)a[c]=b[c]}}return this.require.define}).call(this)({"undefinedlib/base-platform/dom":function(a,b,c){"use strict";c.exports={getChildren:function(a){return Array.prototype.slice.call(a.childNodes)},localName:function(a){return a.localName},getAttribute:function(a,b){return a.getAttribute(b)},hasAttribute:function(a,b){return a.hasAttribute(b)},namespaceURI:function(a){return a.namespaceURI},createElementNS:function(a,b,c){return a.createElementNS(b,c)},setAttribute:function(a,b,c){return a.setAttribute(b,c)},appendChild:function(a,b){return a.appendChild(b)},textContent:function(a,b){if(void 0===b)return 1===a.nodeType?void 0!==a.textContent?a.textContent:this.getChildren(a).map(function(a){return this.textContent(a)},this).join(""):3===a.nodeType||4===a.nodeType?a.data:"";if(1===a.nodeType){if(void 0!==a.textContent)return a.textContent=b;var c=a.ownerDocument.createTextNode(b);return a.appendChild(c),b}return 3===a.nodeType?a.data=b:void 0},getElementChildren:function(a){return this.getChildren(a).filter(function(a){return 1===a.nodeType})}}},"undefinedlib/base-platform/eval":function(exports,require,module){module.exports=function(content,name){return eval("(function(){\nreturn "+content+";})()")}},"undefinedlib/base-platform/path":function(a,b,c){"use strict";c.exports={sep:"/",join:function(a,b){return a+"/"+b},dirname:function(a){return a.split(this.sep).slice(0,-1).join(this.sep)},basename:function(a,b){var c=a.split(this.sep).slice(-1);if(b){var d=this.extname(c);d[1]===b&&(c=d[1])}return c},extname:function(a){return a.split(/\\.(?=[^\\.]+$)/)[1]}}},"undefinedlib/browser/browser-listener-client":function(){},"undefinedlib/browser/build/stitch":function(a,b){var c=b("stitch"),d=b("fs"),e=b("path"),f=c.createPackage({rootModuleName:"scion",paths:["lib"],excludes:[e.join("lib","node"),e.join("lib","rhino"),e.join("lib","browser","build"),e.join("lib","external")]}),g=process.argv[2];f.compile(function(a,b){d.writeFile(g,b,function(a){if(a)throw a;console.log("Compiled",g)})})},"undefinedlib/browser/dom":function(a,b,c){"use strict";function d(a,b){return"item"in a?a.item(b):a[b]}var e=b("../base-platform/dom"),f=Object.create(e);f.hasAttribute=function(a,b){return a.hasAttribute?a.hasAttribute(b):a.getAttribute(b)},f.localName=function(a){return a.localName||a.tagName},f.createElementNS=function(a,b,c){return a.createElementNS?a.createElementNS(b,c):a.createElement(c)},f.getChildren=function(a){for(var b=[],c=0;c<a.childNodes.length;c++)b.push(d(a.childNodes,c));return b},f.serializeToString=function(a){return a.xml||(new XMLSerializer).serializeToString(a)},c.exports=f},"undefinedlib/browser/platform":function(a,b){"use strict";b("../core/util/util");a.platform={ajax:window.jQuery,eval:b("../base-platform/eval"),getDocumentFromUrl:function(a,b){this.ajax.get(a,function(a){b(null,a)},"xml").error(function(a){b(a)})},parseDocumentFromString:function(a){return(new window.DOMParser).parseFromString(a,"application/xml")},getDocumentFromFilesystem:function(a,b,c){this.getDocumentFromUrl(a,b,c)},getResourceFromUrl:function(a,b){this.ajax.get(a,function(a){b(null,a)}).error(function(a){b(a)})},postDataToUrl:function(a,b,c){this.ajax.post(a,b,function(a){c(null,a)}).error(function(a){c(a)})},setTimeout:function(a,b){return window.setTimeout(a,b)},clearTimeout:function(a){window.clearTimeout(a)},log:window.console&&window.console.log&&(window.console.log.bind?window.console.log.bind(window.console):window.console.log),path:b("../base-platform/path"),url:b("./url"),dom:b("./dom")}},"undefinedlib/browser/url":function(a,b,c){"use strict";function d(a){var b=document.createElement("a");return b.href=a,b}c.exports={getPathFromUrl:function(a){var b=d(a);return b.pathname},changeUrlPath:function(a,b){var c=d(a);return c.protocol+"//"+c.hostname+":"+c.port+b}}},"undefinedlib/core/constants":function(a,b,c){"use strict";c.exports={SCXML_NS:"http://www.w3.org/2005/07/scxml"}},"undefinedlib/core/scxml/SCXML":function(a,b,c){"use strict";function d(){return function(a){var b=a[0],c=a[1];return b.source.depth<c.source.depth?c:c.source.depth<b.source.depth?b:b.documentOrder<c.documentOrder?b:c}}function e(a,b){this.model=a,this.opts=b,this.opts.log=this.opts.log||k.platform.log,this.opts.StateIdSet=this.opts.StateIdSet||g,this.opts.EventSet=this.opts.EventSet||g,this.opts.TransitionPairSet=this.opts.TransitionPairSet||g,this.opts.priorityComparisonFn=this.opts.priorityComparisonFn||d(this.opts.model),this.opts.retrace=!1,this._sessionid=this.opts.sessionid||"",this._configuration=new this.opts.BasicStateSet,this._historyValue={},this._innerEventQueue=[],this._isInFinalState=!1,this._timeoutMap={},this._listeners=[]}function f(a,b){b=b||{},i(b),this._isStepping=!1,this._send=b.send||this._send,this._cancel=b.cancel||this._cancel,e.call(this,a,b)}var g=b("./set/ArraySet"),h=b("./state-kinds-enum"),i=b("./setup-default-opts"),j=b("./scxml-dynamic-name-match-transition-selector"),k=b("../../platform"),l=!1;e.prototype={start:function(){l&&k.platform.log("performing initial big step"),this._configuration.add(this.model.root.initial);var a=this.opts.require||c.parent&&c.parent.parent&&c.parent.parent.require&&c.parent.parent.require.bind(c.parent.parent)||b.main&&b.main.require&&b.main.require.bind(b.main)||b,d=this.model.actionFactory(this.opts.log,this._cancel.bind(this),this._send.bind(this),this.opts.origin,this.isIn.bind(this),a,k.platform.parseDocumentFromString,this._sessionid);return this._actions=d.actions,this._datamodel=d.datamodel,this._performBigStep(),this.getConfiguration()},_getOrSetData:function(a,b,c){var d=this._datamodel[b];if(!d)throw new Error("Variable "+b+" not declared in datamodel.");return d[a](c)},_getData:function(a){return this._getOrSetData("get",a)},_setData:function(a,b){return this._getOrSetData("set",a,b)},getConfiguration:function(){return this._configuration.iter().map(function(a){return a.id})},getFullConfiguration:function(){return this._configuration.iter().map(function(a){return[a].concat(this.opts.model.getAncestors(a))},this).reduce(function(a,b){return a.concat(b)},[]).map(function(a){return a.id}).reduce(function(a,b){return a.indexOf(b)>-1?a:a.concat(b)},[])},isIn:function(a){return this.getFullConfiguration().indexOf(a)>-1},isFinal:function(){return this._isInFinalState},_performBigStep:function(a){a&&this._innerEventQueue.push(new this.opts.EventSet([a]));for(var b=!0;b;){var c=this._innerEventQueue.length?this._innerEventQueue.shift():new this.opts.EventSet,d={},e=this._performSmallStep(c,d);b=!e.isEmpty()}this._isInFinalState=this._configuration.iter().every(function(a){return a.kind===h.FINAL})},_performSmallStep:function(a,b){l&&k.platform.log("selecting transitions with eventSet: ",a);var c=this._selectTransitions(a,b);if(l&&k.platform.log("selected transitions: ",c),!c.isEmpty()){l&&k.platform.log("sorted transitions: ",console.log(c));var d=new this.opts.TransitionSet(c.iter().filter(function(a){return a.targets})),e=this._getStatesExited(d),f=e[0],g=e[1],i=this._getStatesEntered(d),j=i[0],m=i[1];l&&k.platform.log("basicStatesExited ",f),l&&k.platform.log("basicStatesEntered ",j),l&&k.platform.log("statesExited ",g),l&&k.platform.log("statesEntered ",m);var n=new this.opts.EventSet;l&&k.platform.log("executing state exit actions"),g.forEach(function(c){(l||this.opts.logStatesEnteredAndExited)&&k.platform.log("exiting ",c.id),this._listeners.forEach(function(a){a.onExit&&a.onExit(c.id)}),void 0!==c.onexit&&this._evaluateAction(c.onexit,a,b,n);var d;c.history&&(d=c.history.isDeep?function(a){return a.kind===h.BASIC&&c.descendants.indexOf(a)>-1}:function(a){return a.parent===c},this._historyValue[c.history.id]=g.filter(d))},this);var o=c.iter().sort(function(a,b){return a.documentOrder-b.documentOrder});l&&k.platform.log("executing transitition actions"),o.forEach(function(c){var d=c.targets&&c.targets.map(function(a){return a.id});this._listeners.forEach(function(a){a.onTransition&&a.onTransition(c.source.id,d)}),void 0!==c.actions&&this._evaluateAction(c.actions,a,b,n)},this),l&&k.platform.log("executing state enter actions"),m.forEach(function(c){(l||this.opts.logStatesEnteredAndExited)&&k.platform.log("entering",c.id),this._listeners.forEach(function(a){a.onEntry&&a.onEntry(c.id)}),void 0!==c.onentry&&this._evaluateAction(c.onentry,a,b,n)},this),l&&k.platform.log("updating configuration "),l&&k.platform.log("old configuration ",this._configuration),this._configuration.difference(f),this._configuration.union(j),l&&k.platform.log("new configuration ",this._configuration),n.isEmpty()||(l&&k.platform.log("adding triggered events to inner queue ",n),this._innerEventQueue.push(n)),l&&k.platform.log("updating datamodel for next small step :");for(var p in b)this._setData(p,b[p])}return c},_evaluateAction:function(a,b,c,d){function e(a){d.add({name:a,data:{}})}if(!this.opts.retrace){var f=this._getScriptingInterface(c,b,!0);return this._actions[a].call(this.opts.evaluationContext,f.getData,f.setData,f.events,e)}},_getScriptingInterface:function(a,b,c){return{setData:c?function(b,c){return a[b]=c}:function(){},getData:this._getData.bind(this),events:b.iter()}},_getStatesExited:function(a){var b=new this.opts.StateSet,c=new this.opts.BasicStateSet;a.iter().forEach(function(a){var d=a.scope,e=d.descendants;this._configuration.iter().forEach(function(a){e.indexOf(a)>-1&&(c.add(a),b.add(a),this.opts.model.getAncestors(a,d).forEach(function(a){b.add(a)}))},this)},this);var d=b.iter().sort(function(a,b){return b.depth-a.depth});return[c,d]},_getStatesEntered:function(a){var b={statesToEnter:new this.opts.StateSet,basicStatesToEnter:new this.opts.BasicStateSet,statesProcessed:new this.opts.StateSet,statesToProcess:[]};a.iter().forEach(function(a){a.targets.forEach(function(c){this._addStateAndAncestors(c,a.scope,b)},this)},this);for(var c;c=b.statesToProcess.pop();)this._addStateAndDescendants(c,b);var d=b.statesToEnter.iter().sort(function(a,b){return a.depth-b.depth});return[b.basicStatesToEnter,d]},_addStateAndAncestors:function(a,b,c){this._addStateAndDescendants(a,c),this.opts.model.getAncestors(a,b).forEach(function(a){a.kind===h.COMPOSITE?(c.statesToEnter.add(a),c.statesProcessed.add(a)):this._addStateAndDescendants(a,c)},this)},_addStateAndDescendants:function(a,b){b.statesProcessed.contains(a)||(a.kind===h.HISTORY?a.id in this._historyValue?this._historyValue[a.id].forEach(function(c){this._addStateAndAncestors(c,a.parent,b)},this):(b.statesToEnter.add(a),b.basicStatesToEnter.add(a)):(b.statesToEnter.add(a),a.kind===h.PARALLEL?b.statesToProcess.push.apply(b.statesToProcess,a.children.filter(function(a){return a.kind!==h.HISTORY})):a.kind===h.COMPOSITE?b.statesToProcess.push(a.initial):(a.kind===h.INITIAL||a.kind===h.BASIC||a.kind===h.FINAL)&&b.basicStatesToEnter.add(a)),b.statesProcessed.add(a))},_selectTransitions:function(a,b){if(this.opts.onlySelectFromBasicStates)var c=this._configuration.iter();else{var d=new this.opts.StateSet;this._configuration.iter().forEach(function(a){d.add(a),this.opts.model.getAncestors(a).forEach(function(a){d.add(a)})},this),c=d.iter()}var e=this._getScriptingInterface(b,a),f=function(a){return this._actions[a.conditionActionRef].call(this.opts.evaluationContext,e.getData,e.setData,e.events)}.bind(this),g=a.iter().map(function(a){return a.name}),h=g.filter(function(a){return a.search(".")}).length,i=h?j:this.opts.transitionSelector,m=new this.opts.TransitionSet;c.forEach(function(a){i(a,g,f).forEach(function(a){m.add(a)})});var n=this._selectPriorityEnabledTransitions(m);return l&&k.platform.log("priorityEnabledTransitions",n),n},_selectPriorityEnabledTransitions:function(a){var b=new this.opts.TransitionSet,c=this._getInconsistentTransitions(a),d=c[0],e=c[1];for(b.union(d),l&&k.platform.log("enabledTransitions",a),l&&k.platform.log("consistentTransitions",d),l&&k.platform.log("inconsistentTransitionsPairs",e),l&&k.platform.log("priorityEnabledTransitions",b);!e.isEmpty();)a=new this.opts.TransitionSet(e.iter().map(function(a){return this.opts.priorityComparisonFn(a)},this)),c=this._getInconsistentTransitions(a),d=c[0],e=c[1],b.union(d),l&&k.platform.log("enabledTransitions",a),l&&k.platform.log("consistentTransitions",d),l&&k.platform.log("inconsistentTransitionsPairs",e),l&&k.platform.log("priorityEnabledTransitions",b);return b},_getInconsistentTransitions:function(a){var b=new this.opts.TransitionSet,c=new this.opts.TransitionPairSet,d=a.iter();l&&k.platform.log("transitions",d);for(var e=0;e<d.length;e++)for(var f=e+1;f<d.length;f++){var g=d[e],h=d[f];this._conflicts(g,h)&&(b.add(g),b.add(h),c.add([g,h]))}var i=a.difference(b);return[i,c]},_conflicts:function(a,b){return!this._isArenaOrthogonal(a,b)},_isArenaOrthogonal:function(a,b){var c=this.opts.model.isOrthogonalTo(a.scope,b.scope);return l&&(k.platform.log("transition scopes",a.scope.id,a.scope.id),k.platform.log("transition scopes are orthogonal?",c)),c},registerListener:function(a){return this._listeners.push(a)},unregisterListener:function(a){var b,c=this._listeners.indexOf(a);return c>=0&&(b=this._listeners.splice(c,1)),b}},f.prototype=Object.create(e.prototype),f.prototype.gen=function(a,b){var c;switch(typeof a){case"string":c={name:a,data:b};break;case"object":if("string"!=typeof a.name)throw new Error('Event object must have "name" property of type string.');c=a;break;default:throw new Error("First argument to gen must be a string or object.")}if(this._isStepping)throw new Error("gen called before previous call to gen could complete. If executed in single-threaded environment, this means it was called recursively, which is illegal, as it would break SCION step semantics.");return this._isStepping=!0,this._performBigStep(c),this._isStepping=!1,this.getConfiguration()},f.prototype._send=function(a,b){var c,d,e=this;if(!k.platform.setTimeout)throw new Error("setTimeout function not set");return l&&k.platform.log("sending event",a.name,"with content",a.data,"after delay",b.delay),c=function(){return e.gen(a)},d=k.platform.setTimeout(c,b.delay),b.sendid?this._timeoutMap[b.sendid]=d:void 0},f.prototype._cancel=function(a){if(!k.platform.clearTimeout)throw new Error("clearTimeout function not set");return a in this._timeoutMap?(l&&k.platform.log("cancelling ",a," with timeout id ",this._timeoutMap[a]),k.platform.clearTimeout(this._timeoutMap[a])):void 0},c.exports={SCXMLInterpreter:e,SimpleInterpreter:f}},"undefinedlib/core/scxml/default-transition-selector":function(a,b,c){"use strict";c.exports=function(a,b,c){return a.transitions.filter(function(a){return!a.event||b.indexOf(a.event)>-1&&(!a.cond||c(a))})}},"undefinedlib/core/scxml/json2model":function(a,b,c){"use strict";function d(a){function b(a,b){return d.push(g.gen.util.wrapFunctionBodyInDeclaration(a,b))-1}function c(a){return e[a]}var d=[],e={};a.states.forEach(function(a){e[a.id]=a}),a.transitions.forEach(function(a){a.cond&&(a.conditionActionRef=b(a.cond,!0))}),a.states.forEach(function(d){d.transitions=d.transitions.map(function(b){return a.transitions[b]});d.onentry&&(d.onentry=b(d.onentry)),d.onexit&&(d.onexit=b(d.onexit)),d.transitions.forEach(function(a){a.actions&&(a.actions=b(a.actions)),a.lcca&&(a.lcca=e[a.lcca]),a.scope=e[a.scope]}),d.initial=e[d.initial],d.history=e[d.history],d.children=d.children.map(c),d.parent=e[d.parent],d.ancestors&&(d.ancestors=d.ancestors.map(c)),d.descendants&&(d.descendants=d.descendants.map(c)),d.transitions.forEach(function(a){a.source=e[a.source],a.targets=a.targets&&a.targets.map(c)})}),a.root=e[a.root];var f=g.gen.util.makeActionFactory(a.scripts,d,a.datamodel);return f}function e(a,b){var c=d(a);try{a.actionFactory=f.platform.eval(c,b)}catch(e){throw f.platform.log("Failed to evaluate action factory."),f.platform.log("Generated js code to evaluate\n",c),e}}var f=b("../../platform"),g=b("../util/code-gen");if(c.exports=function(a,b){return e(a,b),a},b.main===c){var h=process.argv[2],i=function(a,b){if(a)throw a;process.stdout.write(d(JSON.parse(b)))};if("-"===h){var j="";process.stdin.resume(),process.stdin.on("data",function(a){j+=a}),process.stdin.on("end",function(){i(null,j)})}else{var k=b("fs");k.readFile(h,"utf8",i)}}},"undefinedlib/core/scxml/model":function(a,b,c){"use strict";var d=b("./state-kinds-enum"),e={getAncestors:function(a,b){var c;return c=a.ancestors.indexOf(b),c>-1?a.ancestors.slice(0,c):a.ancestors},getAncestorsOrSelf:function(a,b){return[a].concat(this.getAncestors(a,b))},getDescendantsOrSelf:function(a){return[a].concat(a.descendants)},isOrthogonalTo:function(a,b){return!this.isAncestrallyRelatedTo(a,b)&&this.getLCA(a,b).kind===d.PARALLEL},isAncestrallyRelatedTo:function(a,b){return this.getAncestorsOrSelf(b).indexOf(a)>-1||this.getAncestorsOrSelf(a).indexOf(b)>-1},getLCA:function(a,b){var c=this.getAncestors(a).filter(function(a){return a.descendants.indexOf(b)>-1},this);return c[0]}};c.exports=e},"undefinedlib/core/scxml/scxml-dynamic-name-match-transition-selector":function(a,b,c){"use strict";function d(a){return new RegExp("^"+a.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")}function e(a){return g[a]?g[a]:g[a]=d(a)}function f(a,b){var c=a.events,d=c.indexOf("*")>-1?function(){return!0}:function(a){return c.filter(function(b){return e(b).test(a)}).length};return b.filter(d).length}var g={};c.exports=function(a,b,c){return a.transitions.filter(function(a){return!(a.events&&!f(a,b)||a.cond&&!c(a))})}},"undefinedlib/core/scxml/set/ArraySet":function(a,b,c){"use strict";function d(a){a=a||[],this.o=[],a.forEach(function(a){this.add(a)},this)}d.prototype={add:function(a){return this.contains(a)?void 0:this.o.push(a)},remove:function(a){var b=this.o.indexOf(a);return-1===b?!1:(this.o.splice(b,1),!0)},union:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.add(a)},this),this},difference:function(a){return a=a.iter?a.iter():a,a.forEach(function(a){this.remove(a)},this),this},contains:function(a){return this.o.indexOf(a)>-1},iter:function(){return this.o},isEmpty:function(){return!this.o.length},equals:function(a){var b=a.iter(),c=this.o;return c.every(function(a){return b.indexOf(a)>-1})&&b.every(function(a){return c.indexOf(a)>-1})},toString:function(){return"Set("+this.o.toString()+")"}},c.exports=d},"undefinedlib/core/scxml/setup-default-opts":function(a,b,c){"use strict";var d=b("./scxml-dynamic-name-match-transition-selector"),e=b("./set/ArraySet"),f=b("./model");c.exports=function(a){return a=a||{},a.TransitionSet=a.TransitionSet||e,a.StateSet=a.StateSet||e,a.BasicStateSet=a.BasicStateSet||e,a.transitionSelector=a.transitionSelector||d,a.model=a.model||f,a}},"undefinedlib/core/scxml/state-kinds-enum":function(a,b,c){"use strict";c.exports={BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5}},"undefinedlib/core/util/annotate-scxml-json":function(a,b,c){"use strict";function d(a){return v.platform.dom.getChildren(a).filter(function(a){return"script"===v.platform.dom.localName(a)}).map(function(a){return v.platform.dom.textContent(a)})}function e(a){var b,c,d;c=0,d={};for(b in a)d[b]={name:b,documentOrder:c++};return d}function f(a,b){if(v.platform.dom.hasAttribute(a,"event")){var c,d=v.platform.dom.getAttribute(a,"event");if(c="*"===d?[d]:d.trim().split(/\s+/).map(function(a){var b=a.match(B);if(b){var c=b[1];if(b&&c)return c;throw new Error("Unable to parse event: "+a)}}),c.filter(function(a){return"*"!==a}).forEach(function(a){n[a]=!0}),c.indexOf(void 0)>-1)throw new Error("Error parsing event attribute attributes.event")}var e={internal:"internal"===v.platform.dom.getAttribute(a,"type"),documentOrder:o.length,id:o.length,source:b.id,cond:v.platform.dom.getAttribute(a,"cond"),events:c,targets:v.platform.dom.hasAttribute(a,"target")?v.platform.dom.getAttribute(a,"target").trim().split(/\s+/):null};return v.platform.dom.getElementChildren(a).length&&(e.actions=t.gen.parentToFnBody(a)),o.push(e),e}function g(a){v.platform.dom.getChildren(a).filter(function(a){return"data"===v.platform.dom.localName(a)}).forEach(function(a){if(v.platform.dom.hasAttribute(a,"id")){var b,c=v.platform.dom.getAttribute(a,"id");if(v.platform.dom.hasAttribute(a,"expr"))b={content:v.platform.dom.getAttribute(a,"expr"),type:"expr"};else{var d=v.platform.dom.hasAttribute(a,"type");if(d){var e=v.platform.dom.getAttribute(a,"type"),f="xml"===e?v.platform.dom.serializeToString(a):v.platform.dom.textContent(a);b={content:f,type:e}}else f=v.platform.dom.textContent(a),b=f.length?{content:f,type:"text"}:null}r[c]=b}})}function h(a,b){var c,d,e;switch(v.platform.dom.localName(a)){case"state":d=v.platform.dom.getChildren(a).filter(function(a){return y.indexOf(v.platform.dom.localName(a))>-1}).length?w.COMPOSITE:w.BASIC;break;case"scxml":d=w.COMPOSITE;break;case"initial":d=w.INITIAL;break;case"parallel":d=w.PARALLEL;break;case"final":d=w.FINAL;break;case"history":d=w.HISTORY}c=v.platform.dom.hasAttribute(a,"id")?v.platform.dom.getAttribute(a,"id"):i(v.platform.dom.localName(a)),e=v.platform.dom.hasAttribute(a,"id")&&d!==w.HISTORY?{id:c,kind:d,descendants:[],name:v.platform.dom.getAttribute(a,"name"),type:v.platform.dom.getAttribute(a,"type")}:{id:c,kind:d,descendants:[]},p[c]=e,b.length&&(e.parent=b[b.length-1]),d===w.HISTORY&&(e.isDeep="deep"===v.platform.dom.getAttribute(a,"type")?!0:!1),e.documentOrder=l.length,l.push(e),(d===w.BASIC||d===w.INITIAL||d===w.HISTORY)&&(e.basicDocumentOrder=m.length,m.push(e)),e.depth=b.length,e.ancestors=b.slice(),b.forEach(function(a){p[a].descendants.push(e.id)});var j,k,n=[],o=[],q=b.concat(e.id),r=!1,z=null,A=function(a){var b=h(a,q);return e.initial=b.id,o.push(b),r=!0};if(v.platform.dom.getElementChildren(a).forEach(function(a){switch(v.platform.dom.localName(a)){case"transition":n.push(f(a,e));break;case"onentry":k=t.gen.parentToFnBody(a);break;case"onexit":j=t.gen.parentToFnBody(a);break;case"initial":if(r)throw new Error("Encountered duplicate initial states in state "+e.id);A(a);break;case"history":var b=h(a,q);e.history=b.id,o.push(b);break;case"datamodel":g(a,q);break;default:if(x.indexOf(v.platform.dom.localName(a))>-1){var c=h(a,q);null===z&&(z=c),o.push(c)}}}),!r&&"parallel"!==v.platform.dom.localName(a)){var B=v.platform.dom.hasAttribute(a,"initial"),C=function(a){var b=v.platform.dom.createElementNS(s,u.SCXML_NS,"initial"),c=v.platform.dom.createElementNS(s,u.SCXML_NS,"transition");return v.platform.dom.setAttribute(c,"target",a),v.platform.dom.appendChild(b,c),A(b)};B?C(v.platform.dom.getAttribute(a,"initial")):z&&C(z.id)}return e.onexit=j,e.onentry=k,e.transitions=n.map(function(a){return a.documentOrder}),e.children=o.map(function(a){return a.id}),e}function i(a){return D[a]=D[a]||0,""+C+"-"+a+"-"+D[a]++}function j(a,b){var c,d;if(d=[],a.ancestors.forEach(function(a){c=p[a],c.kind===w.COMPOSITE&&c.descendants.indexOf(b.id)>-1&&d.push(a)}),!d.length)throw new Error("Could not find LCCA for states.");return d[0]}function k(a){var b=p[a.source],c=a.internal&&b.parent&&a.targets&&a.targets.map(function(a){return p[a]}).every(function(a){return b.descendants.map(function(a){return p[a]}).indexOf(a)>-1});return a.targets?c?a.source:a.lcca:a.source}var l,m,n,o,p,q,r,s,t=b("./code-gen"),u=b("../constants"),v=b("../../platform"),w=b("../scxml/state-kinds-enum"),x=["state","parallel","history","final","initial"],y=x.concat("scxml"),z=a.transformAndSerialize=z=function(a){return JSON.stringify(A(a))},A=a.transform=function(a){s=a;var b=s.documentElement;l=[],m=[],n={},o=[],p={},q=[],r={};var c=h(b,[]);return l.forEach(function(a){a.ancestors.reverse()}),l.forEach(function(a){a.descendants.reverse()}),o.filter(function(a){return a.targets}).forEach(function(a){var b=p[a.source],c=a.targets.map(function(a){var b=p[a];if(!b)throw new Error("Transition targets state id '"+a+"' but state does not exist.");return b});a.lcca=j(b,c[0])}),o.forEach(function(a){a.scope=k(a)}),{states:l,transitions:o,root:c.id,events:e(n),scripts:d(b),profile:v.platform.dom.getAttribute(b,"profile"),version:v.platform.dom.getAttribute(b,"version"),datamodel:r}},B=/^((([^.]+)\.)*([^.]+))(\.\*)?$/,C="$generated",D={};b.main===c&&console.log(JSON.stringify(A((new(b("xmldom").DOMParser)).parseFromString(b("fs").readFileSync(process.argv[2],"utf8"))),4,4))},"undefinedlib/core/util/code-gen":function(a,b,c){"use strict";function d(a){return p.platform.dom.getElementChildren(a).map(e).join("\n;;\n")}function e(a){var b=r[p.platform.dom.namespaceURI(a)],c=b&&b[p.platform.dom.localName(a)];if(!b||!c)throw new Error("Element "+p.platform.dom.namespaceURI(a)+":"+p.platform.dom.localName(a)+" not yet supported");return c(a)}function f(a){return a?"ms"===a.slice(-2)?parseFloat(a.slice(0,-2)):"s"===a.slice(-1)?1e3*parseFloat(a.slice(0,-1)):parseFloat(a):0}function g(a,b){var c=a;if(b)switch(c+=" = ",b.type){case"xml":c+="$parseXml("+JSON.stringify(b.content)+")";break;case"json":c+="JSON.parse("+JSON.stringify(b.content)+")";break;case"expr":c+=b.content;break;default:c+=JSON.stringify(b.content)}return c}function h(a){var b="var ",c=[];for(var d in a){var e=a[d];c.push(g(d,e))}return c.length?b+c.join(", ")+";":""}function i(a){var b=[];for(var c in a)b.push('"'+c+'" : {\n"set" : function(v){ return '+c+' = v; },\n"get" : function(){ return '+c+";}\n}");return"{\n"+b.join(",\n")+"\n}"}function j(a,b){return"function(getData,setData,_events,$raise){var _event = _events[0];\n"+(b?"return":"")+" "+a+"\n}"}function k(a,b,c,d){return a+(b.length?b.join("\n"):"")+"var $datamodel = "+c+";\nreturn {\ndatamodel:$datamodel,\nactions:[\n"+d.join(",\n")+"\n]\n};"}function l(a){return"function($log,$cancel,$send,$origin,In,require,$parseXml,_sessionid,_ioprocessors,_x){\n"+a+"\n}"}function m(a,b,c){var d=h(c),e=i(c),g=f.toString()+"\n"+k(d,a,e,b),j=l(g);return j}function n(a){var b=p.platform.dom.hasAttribute(a,"namelist")?p.platform.dom.getAttribute(a,"namelist").trim().split(/ +/):null,c=p.platform.dom.getChildren(a).filter(function(a){return"param"===p.platform.dom.localName(a)}),d=p.platform.dom.getChildren(a).filter(function(a){return"content"===p.platform.dom.localName(a)});if(d.length)return d=d[0],"application/json"===p.platform.dom.getAttribute(d,"type")?p.platform.dom.textContent(d):JSON.stringify(p.platform.dom.textContent(d));if(p.platform.dom.hasAttribute(a,"contentexpr"))return p.platform.dom.getAttribute(a,"contentexpr");var e="{";return b&&b.forEach(function(a){e+='"'+a+'":'+a+",\n"}),c.length&&c.map(function(a){return o(a)}).forEach(function(a){a.expr?e+='"'+a.name+'":'+a.expr+",\n":a.location&&(e+='"'+a.name+'":'+a.location+",\n")}),e+="}"}function o(a){return{name:p.platform.dom.getAttribute(a,"name"),expr:p.platform.dom.getAttribute(a,"expr"),location:p.platform.dom.getAttribute(a,"location")}}var p=b("../../platform"),q=b("../constants"),r={"":{script:function(a){return p.platform.dom.textContent(a)},assign:function(a){return p.platform.dom.getAttribute(a,"location")+" = "+p.platform.dom.getAttribute(a,"expr")+";"},"if":function(a){var b="";b+="if("+p.platform.dom.getAttribute(a,"cond")+"){\n";for(var c=p.platform.dom.getElementChildren(a),d=0;d<c.length;d++){var f=c[d];if("elseif"===p.platform.dom.localName(f)||"else"===p.platform.dom.localName(f))break;b+=e(f)+"\n;;\n"}for(;d<c.length;d++)if(f=c[d],"elseif"===p.platform.dom.localName(f))b+="}else if("+p.platform.dom.getAttribute(f,"cond")+"){\n";else{if("else"===p.platform.dom.localName(f)){b+="}";break}b+=e(f)+"\n;;\n"}for(;d<c.length;d++)f=c[d],b+="else"===p.platform.dom.localName(f)?"else{\n":e(f)+"\n;;\n";return b+="}"},elseif:function(){throw new Error("Encountered unexpected elseif tag.")},"else":function(){throw new Error("Encountered unexpected else tag.")},log:function(a){var b=[];return p.platform.dom.hasAttribute(a,"label")&&b.push(JSON.stringify(p.platform.dom.getAttribute(a,"label"))),p.platform.dom.hasAttribute(a,"expr")&&b.push(p.platform.dom.getAttribute(a,"expr")),"$log("+b.join(",")+");"},raise:function(a){return"$raise({ name:"+JSON.stringify(p.platform.dom.getAttribute(a,"event"))+", data : {}});"},cancel:function(a){return"$cancel("+JSON.stringify(p.platform.dom.getAttribute(a,"sendid"))+");"},send:function(a){var b=p.platform.dom.hasAttribute(a,"targetexpr")?p.platform.dom.getAttribute(a,"targetexpr"):JSON.stringify(p.platform.dom.getAttribute(a,"target")),c="_scionTargetRef",d="var "+c+" = "+b+";\n",e="{\ntarget: "+c+",\nname: "+(p.platform.dom.hasAttribute(a,"eventexpr")?p.platform.dom.getAttribute(a,"eventexpr"):JSON.stringify(p.platform.dom.getAttribute(a,"event")))+",\ntype: "+(p.platform.dom.hasAttribute(a,"typeexpr")?p.platform.dom.getAttribute(a,"typeexpr"):JSON.stringify(p.platform.dom.getAttribute(a,"type")))+",\ndata: "+n(a)+",\norigin: $origin\n}",g=d+"if("+c+" === '#_internal'){\n$raise("+e+");\n}else{\n$send("+e+", {\ndelay: "+(p.platform.dom.hasAttribute(a,"delayexpr")?"getDelayInMs("+p.platform.dom.getAttribute(a,"delayexpr")+")":f(p.platform.dom.getAttribute(a,"delay")))+",\nsendId: "+(p.platform.dom.hasAttribute(a,"idlocation")?p.platform.dom.getAttribute(a,"idlocation"):JSON.stringify(p.platform.dom.getAttribute(a,"id")))+"\n}, $raise);}";return g},foreach:function(a){var b=(p.platform.dom.hasAttribute(a,"index"),p.platform.dom.getAttribute(a,"index")||"$i"),c=p.platform.dom.getAttribute(a,"item"),d=p.platform.dom.getAttribute(a,"array"),f=p.platform.dom.getElementChildren(a).map(e).join("\n;;\n");return"(function(){\nif(Array.isArray("+d+")){\n"+d+".forEach(function("+c+","+b+"){\n"+f+"\n});\n}else{\nObject.keys("+d+").forEach(function("+b+"){\n"+c+" = "+d+"["+b+"];\n"+f+"\n});\n}\n})();"}}};r[q.SCXML_NS]=r[""],c.exports={gen:{parentToFnBody:d,actionTagToFnBody:e,actionTags:r,util:{makeDatamodelDeclaration:h,makeDatamodelClosures:i,wrapFunctionBodyInDeclaration:j,makeTopLevelFunctionBody:k,wrapTopLevelFunctionBodyInDeclaration:l,makeActionFactory:m}}}},"undefinedlib/core/util/docToModel":function(a,b,c){"use strict";function d(a,b,c,d){k.platform.getResourceFromUrl?g(a,b,d,function(d){d?c(1===d.length?d[0].err:new Error("Script download errors : \n"+d.map(function(a){return a.url+": "+a.err.message}).join("\n"))):e(a,b,c)}):e(a,b,c)}function e(a,b,c){try{var d=i.transform(b),e=j(d,a);c(null,e)}catch(f){c(f)}}function f(a,b){var c;if(k.platform.url.resolve)c=k.platform.url.resolve(a,b);else{var d=k.platform.url.getPathFromUrl(a),e=k.platform.path.dirname(d),f=k.platform.path.join(e,b);c=k.platform.url.changeUrlPath(a,f)}return c}function g(a,b,c,d){var e=[],g=[],i=0;h(b.documentElement,e),e.length?e.forEach(function(b){var h=k.platform.dom.getAttribute(b,"src");a&&(h=f(a,h)),k.platform.getResourceFromUrl(h,function(a,c){a?(k.platform.log("Error downloading document "+h+" : "+a.message),g.push({url:h,err:a})):k.platform.dom.textContent(b,c),++i,i==e.length&&d(g.length?g:null)},c)}):d()}function h(a,b){"script"!==k.platform.dom.localName(a)&&"data"!==k.platform.dom.localName(a)||!k.platform.dom.hasAttribute(a,"src")||b.push(a),k.platform.dom.getElementChildren(a).forEach(function(a){h(a,b)})}var i=b("./annotate-scxml-json"),j=b("../scxml/json2model"),k=b("../../platform");c.exports=d},"undefinedlib/core/util/util":function(a,b,c){"use strict";c.exports={merge:function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a}}},"undefinedlib/node/dom":function(a,b,c){"use strict";c.exports=b("../base-platform/dom");var d=b("xmldom").XMLSerializer;c.exports.serializeToString=function(a){return(new d).serializeToString(a)
}},"undefinedlib/node/get":function(a,b,c){"use strict";function d(a,b){var c=h.parse(a);g.get(c,function(a){var c="";a.on("data",function(a){c+=a}),a.on("end",function(){200===a.statusCode?b(null,c):b(new Error("HTTP code "+a.statusCode+" : "+c))})}).on("error",function(a){b(a)})}function e(){}function f(a,b){var c=h.parse(a);"http:"===c.protocol||"https:"===a.protocol?d(a,b):c.protocol?b(new Error("Unrecognized protocol")):i.readFile(a,"utf8",b)}var g=b("http"),h=b("url"),i=b("fs");c.exports={getResource:f,httpGet:d,httpPost:e}},"undefinedlib/node/node-listener-client":function(a,b,c){"use strict";function d(a){this.options=a;var b=new f.Agent;b.maxSockets=1,this.defaultOptions={host:"localhost",port:"1337",agent:b}}function e(a){for(var b=1;b<arguments.length;b++)for(var c in arguments[b]){var d=arguments[b][c];a[c]=d}}var f=b("http");d.prototype={onEntry:function(a){f.get(e({path:"/onEntry?id="+a},this.defaultOptions,this.options),function(){})},onExit:function(a){f.get(e({path:"/onExit?id="+a},this.defaultOptions,this.options),function(){})},onTransition:function(){}},c.exports=d},"undefinedlib/node/node-scxml-gui-http-proxy-server":function(a,b){"use strict";var c=b("http"),d=b("url"),e=b("net"),f=process.argv.slice(2),g=f[0]||1337,h=f[1]||"localhost",i=parseInt(f[2],10)||9999,j=new e.Socket;j.connect(i,h,function(){}),j.on("error",function(){console.log("Could not connect to service at host "+h+", port "+i),k&&k.close()}),j.on("data",function(a){console.log("received data from scxmlGUI socket",a)}),j.on("close",function(){console.log("scxmlGUI socket closed unexpectedly"),k&&k.close()});var k=c.createServer(function(a,b){var c=d.parse(a.url,!0);switch(c.pathname){case"/onEntry":j.write("1 "+c.query.id+"\n");break;case"/onExit":j.write("0 "+c.query.id+"\n");break;case"/onTransition":break;default:return b.writeHead(400,{"Content-Type":"text/plain"}),void b.end("Unable to understand request\n")}b.writeHead(200,{"Content-Type":"text/plain"}),b.end("Request processed\n")}).listen(g)},"undefinedlib/node/platform":function(a,b){"use strict";function c(a){return(new e.DOMParser).parseFromString(a)}function d(a){return function(b,d){if(b)a(b);else try{var e=c(d);a(null,e)}catch(f){a(f)}}}var e=b("xmldom"),f=b("fs"),g=b("./get"),h=(b("path"),b("./url")),i=b("vm");a.platform={getDocumentFromUrl:function(a,b){g.httpGet(a,d(b))},parseDocumentFromString:c,getDocumentFromFilesystem:function(a,b){f.readFile(a,"utf8",d(b))},getResourceFromUrl:g.getResource,postDataToUrl:function(){},setTimeout:setTimeout,clearTimeout:clearTimeout,log:console.log,eval:function(a,b){function c(){var a={};for(var b in global)a[b]=global[b];return a}return i.runInNewContext("("+a+");",c(),b)},path:b("path"),url:h,dom:b("./dom")}},"undefinedlib/node/url":function(a,b,c){"use strict";var d=b("url");c.exports={getPathFromUrl:function(a){var b=d.parse(a);return b.pathname},changeUrlPath:function(a,b){var c=d.parse(a);return c.path=c.pathname=b,d.format(c)},resolve:function(a,b){return d.resolve(a,b)}}},"undefinedlib/platform":function(a,b,c){"use strict";function d(){return"undefined"!=typeof Packages}function e(){return"undefined"!=typeof process&&"undefined"!=typeof c}function f(){return"undefined"!=typeof window&&"undefined"!=typeof document}f()?c.exports=b("./browser/platform"):e()?c.exports=b("./node/platform"):d()&&(c.exports=b("./rhino/platform"))},"undefinedlib/rhino/dom":function(a,b,c){"use strict";var d=b("../base-platform/dom"),e=Object.create(d);e.getChildren=function(a){for(var b=[],c=0;c<a.childNodes.length;c++)b.push(a.childNodes.item(c));return b},["localName","getAttribute","namespaceURI","textContent"].forEach(function(a){var b=d[a];e[a]=function(){return String(b.apply(this,arguments))}}),e.serializeToString=function(a){var b=new Packages.java.io.ByteArrayOutputStream,c=new Packages.org.apache.xml.serialize.XMLSerializer(b,new Packages.org.apache.xml.serialize.OutputFormat);c.asDOMSerializer().serialize(a);var d=String(new Packages.java.lang.String(b.toByteArray()));return d},c.exports=e},"undefinedlib/rhino/get":function(a,b,c){"use strict";function d(a){var b=new Packages.java.net.URL(a),c=b.openConnection();c.setRequestMethod("GET");for(var d,e=new Packages.java.io.BufferedReader(new Packages.java.io.InputStreamReader(c.getInputStream())),f="";d=e.readLine();)f+=d;return e.close(),f}function e(){}function f(a){for(var b,c=new Packages.java.io.BufferedReader(new Packages.java.io.InputStreamReader(new Packages.java.io.DataInputStream(new Packages.java.io.FileInputStream(a)))),d="";b=c.readLine();)d+=b;return c.close(),d}function g(a,b){try{if(a.match(/^http(s?):/)){var c=d(a);b(null,c)}else c=f(a),b(null,c)}catch(e){b(e)}}c.exports={httpGet:d,httpPost:e,readFile:f,getResource:g}},"undefinedlib/rhino/path":function(a,b,c){"use strict";c.exports={join:function(a,b){return new Packages.java.io.File(a,b).path},dirname:function(a){return new Packages.java.io.File(a).parent},basename:function(a,b){var c=Packages.java.io.File(a).name;if(b){var d=this.extname(c);d[1]===b&&(c=d[1])}return c},extname:function(a){return a.split(/\\.(?=[^\\.]+$)/)[1]}}},"undefinedlib/rhino/platform":function(a,b){"use strict";function c(){var a=Packages.javax.xml.parsers.DocumentBuilderFactory.newInstance();return a.setNamespaceAware(!0),a.newDocumentBuilder()}var d=b("./timeout"),e=b("./get"),f=b("./path"),g=b("./url");a.platform={getDocumentFromUrl:function(a,b){try{var d=c().parse(a);b(null,d)}catch(e){b(e)}},parseDocumentFromString:function(a){var b=c(),d=new Packages.org.xml.sax.InputSource;return d.setCharacterStream(new Packages.java.io.StringReader(a)),b.parse(d)},getDocumentFromFilesystem:function(a,b,c){this.getDocumentFromUrl(a,b,c)},getResourceFromUrl:e.getResource,postDataToUrl:function(){},setTimeout:d.setTimeout,clearTimeout:d.clearTimeout,log:function(){for(var a=0;a<arguments.length;a++)Packages.java.lang.System.out.println(String(arguments[a]))},eval:function(a,b){var c=Packages.org.mozilla.javascript.ContextFactory.getGlobal().enterContext();return c.evaluateString(this,"("+a+")",b,0,null)},path:f,url:g,dom:b("./dom")}},"undefinedlib/rhino/timeout":function(a){"use strict";!function(){function b(){f--,0===f&&(c=null)}var c,d=1,e={},f=0;a.setTimeout=function(a,g){var h=d++;f++,c||(c=new Packages.java.util.Timer);var i=new Packages.java.util.TimerTask({run:function(){b(),a()}});return c.schedule(i,g),e[h]=i,h},a.clearTimeout=function(a){var d=e[a];d.cancel(),c.purge(),delete e[a],b()}}()},"undefinedlib/rhino/url":function(a,b,c){"use strict";c.exports={getPathFromUrl:function(a){var b=new Packages.java.net.URL(a);return b.path},changeUrlPath:function(a,b){var c=new Packages.java.net.URL(a);return String(new Packages.java.net.URL(c.protocol,c.host,c.port,b).toString())},resolve:function(a,b){var c=new Packages.java.net.URL(new Packages.java.net.URL(a),b);return c.toString()}}},"undefinedlib/scion":function(a,b,c){"use strict";function d(a,b,c){if(!g.platform.getDocumentFromUrl)throw new Error("Platform does not support getDocumentFromUrl");g.platform.getDocumentFromUrl(a,function(d,e){d?b(d,null):i(a,e,b,c)},c)}function e(a,b,c){if(!g.platform.getDocumentFromFilesystem)throw new Error("Platform does not support getDocumentFromFilesystem");g.platform.getDocumentFromFilesystem(a,function(d,e){d?b(d,null):i(a,e,b,c)},c)}function f(a,b,c){if(!g.platform.parseDocumentFromString)throw new Error("Platform does not support parseDocumentFromString");i(null,g.platform.parseDocumentFromString(a),b,c)}{var g=b("./platform"),h=b("./core/scxml/SCXML"),i=b("./core/util/docToModel");c.exports={pathToModel:e,urlToModel:d,documentStringToModel:f,documentToModel:i,SCXML:h.SimpleInterpreter,ext:{platformModule:g,actionCodeGeneratorModule:b("./core/util/code-gen")}}}}});
//# sourceMappingURL=scion.min.map